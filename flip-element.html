<!--
@license
Copyright (c) 2016 The Ingresso RÃ¡pido Web Components Authors. All rights reserved.
This code may only be used under the BSD style license found at http://ingressorapidowebcomponents.github.io/LICENSE.txt
The complete set of authors may be found at http://ingressorapidowebcomponents.github.io/AUTHORS.txt
The complete set of contributors may be found at http://ingressorapidowebcomponents.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">

<!--

The `flip-element` allows you to add two children nodes, one should have a `front` attribute and the other should have a `back` attribute.
After this just call the `flip` when you want, so you will have a great animation!

![alt front](images/front.png) ![alt back](images/back.png)

It's important to define the same size to front and back children node, like this:

```html
    <flip-element id="example">
      <div back style="width: 360px; height: 300px;">
        <iframe width="360" height="300" src="https://www.youtube.com/embed/c6SMZAOwrQQ" frameborder="0" allowfullscreen>
        </iframe>
      </div>
      <img front style="width: 360px; height: 300px;" src="https://s-media-cache-ak0.pinimg.com/originals/83/90/0a/83900a5b6d403ddbfd4e843ea70828f4.jpg">
    </flip-element>
```

After that, create an editor:
```js
    this.$.example.flip();
```

@demo demo/index.html

-->

<dom-module id="flip-element">
  <template>
    <style>
      * {
        box-sizing: border-box;
      }

      .container {
        z-index: 99;
        background-color: var(--flip-element-background-color, white);
        font-family:verdana;
        height: 100%;
        perspective: 500px;
        position: relative;
        width: 100%;
      }

      .card {
        position: relative;
        height: 100%;
        transform-style: preserve-3d;
        transition: 1s;
        width: 100%;
      }
      :host([flip-right]) .card {
        transform-origin: right center;
      }
      :host:not([is-front-side]) .card {
        transform: rotateY(180deg);
      }
      :host:not([backface-visible]) .card {
        backface-visibility: hidden;
        -moz-backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
      }

      .card::content > * {
        position: absolute;
        z-index: 90;
      }
      .card::content > *[back],
      .card::content > .back {
        transform: rotateY(180deg);
        z-index: 89;
      }
    </style>
    <div class="container">
      <div id="card" class="card" style$="height: {{_height}}; width: {{_width}};">
        <content></content>
      </div>
    </div>
  </template>

  <script>
    Polymer({

      is: 'flip-element',

      properties: {
        _observer: {
          type: Object
        },
        _height: {
          type: String,
          value: '100%'
        },
        _width: {
          type: String,
          value: '100%'
        },
        /** If true, the child with the `front` attribute is shown, else, the child with the `back` attribute is shown. */
        isFrontSide: {
          type: Boolean,
          value: true,
          reflectToAttribute: true
        },
        /** Whether to flip the back element to the right of the front element. */
        flipRight: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        /** Whether a side should remain visible (but mirrored) when being flipped to the back. */
        backfaceVisible: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        }
      },

      _computeSize: function() {
        if (this.getContentChildren('content')) {
          var height = 0;
          var width = 0;

          for (var i = 0; this.getContentChildren('content').length > i; i++) {
            var child = this.getContentChildren('content')[i];
            height = Math.max(height, child.clientHeight);
            width = Math.max(width, child.clientWidth);
          }

          this._height = height ? height + 'px' : '100%';
          this._width = width ? width + 'px' : '100%';
        }
      },

      attached: function() {
        var host = this;
        this._observer = Polymer.dom(this.$.contentNode).observeNodes(function(info) {
          host._computeSize();
        });
      },

      /**
       * Shows the front side if the back side is currently shown and vice versa.
       */
      flip: function() {
        this.isFrontSide = !this.isFrontSide;
      }
    });
  </script>
</dom-module>
